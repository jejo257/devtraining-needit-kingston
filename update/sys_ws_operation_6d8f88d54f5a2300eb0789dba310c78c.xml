<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ws_operation">
    <sys_ws_operation action="INSERT_OR_UPDATE">
        <active>true</active>
        <consumes>application/json</consumes>
        <consumes_customized>false</consumes_customized>
        <default_operation_uri/>
        <enforce_acl>cf9d01d3e73003009d6247e603f6a990</enforce_acl>
        <http_method>GET</http_method>
        <name>ni_getinfo (v2)</name>
        <operation_script><![CDATA[(function process(/*RESTAPIRequest*/ request, /*RESTAPIResponse*/ response) {

    // implement resource here
    var fullnm = '';
	var reqUser = request.pathParams.user_name;
	gs.info('The REQUEST user 1'+reqUser);
// var reqInQuery = request.queryParams.ni_query;
	var reqUsrNm = new GlideRecord('sys_user');
//	reqUsrNm.get('user_name',reqUser);
    reqUsrNm.addQuery('user_name',reqUser); 	
	reqUsrNm.query();
	gs.info('User found was'+reqUsrNm.user_name);
	
	if(reqUsrNm.next())
	{
	fullnm = reqUsrNm.sys_id;
	gs.info('Full name of user'+fullnm);
	}
//	gs.info('BEFORE version line code');
		if(!reqUsrNm.user_name)
	{
		gs.info('Inside VERSION2 code');
var api_error = new sn_ws_err.ServiceError(); // for error api just enter sn_ws_err.  then you will get all related methods
		api_error.setStatus(542);
		api_error.setMessage("user not found");
		api_error.setDetail("No user found wit username in ni_getInfo scripted web service");
		response.setError(api_error);
        return ;		
	}
	
	
	
	
	var niCnt = 0;
	var userNICOUNT = new GlideAggregate('x_58872_needit_needit');
	 userNICOUNT.addQuery('u_requested_for',fullnm);
	gs.info('INISDE reqtd user');
	userNICOUNT.addAggregate('COUNT');
   
	//	userNICOUNT.addQuery('u_requested_for','5137153cc611227c000bbd1bd8cd2005');
	//gs.info(userNICOUNT);
//	userNICOUNT.addEncodedQuery(reqInQuery);
//	userNICOUNT.groupBy('u_request_type');
	userNICOUNT.query();
	
	if(userNICOUNT.next())
	{
		
		niCnt = userNICOUNT.getAggregate('COUNT');
        var cnt = parseInt(niCnt);	
	}
	
	
	
	var bdy = {};
	bdy.cnt = niCnt;
	bdy.user = reqUser;
	response.setBody(bdy);
	
	gs.info('Requested User has following number of recordsd'+bdy.cnt);
	
	//return sn_ws_err.NotAcceptableError('The header value is not in Accept format');
	
//	return sn_ws_err.BadRequestError('Incorrect syntax sent during request');
	
	
	
		
		
		
	
	
	
	
	
	
	
})(request, response);]]></operation_script>
        <operation_uri>/api/x_58872_needit/v2/needit_api/nigetinfo/{user_name}</operation_uri>
        <produces>application/json,application/xml,text/xml</produces>
        <produces_customized>false</produces_customized>
        <relative_path>/nigetinfo/{user_name}</relative_path>
        <request_example/>
        <requires_acl_authorization>true</requires_acl_authorization>
        <requires_authentication>true</requires_authentication>
        <requires_snc_internal_role>true</requires_snc_internal_role>
        <short_description>Find the NeedIt active NeedIt records for a user. Group by What needed.</short_description>
        <sys_class_name>sys_ws_operation</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2018-12-09 13:17:39</sys_created_on>
        <sys_id>6d8f88d54f5a2300eb0789dba310c78c</sys_id>
        <sys_mod_count>9</sys_mod_count>
        <sys_name>ni_getinfo (v2)</sys_name>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_ws_operation_6d8f88d54f5a2300eb0789dba310c78c</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2018-12-09 14:11:36</sys_updated_on>
        <web_service_definition display_value="NeedIt API">bb07f7464f022300eb0789dba310c7cf</web_service_definition>
        <web_service_version display_value="v2">2d8f88d54f5a2300eb0789dba310c788</web_service_version>
    </sys_ws_operation>
</record_update>
